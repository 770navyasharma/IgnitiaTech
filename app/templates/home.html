{% extends "base.html" %}

{% block title %}Dashboard{% endblock %}

{% block page_title %}
    Welcome, {{ current_user.first_name or current_user.username }}!
    <h5 class="page-subtitle"><i>You have {{ investigations|length }} active investigations.</i></h5>
{% endblock %}

{% block content %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/dashboard.css') }}">

<div class="dashboard-grid">
    <div class="dashboard-main-column">
        <div class="dashboard-card">
            <div class="dashboard-card-header">
                <h2 class="section-title">Active Investigations</h2>
                <button class="options-btn"><i class="fas fa-ellipsis-v"></i></button>
            </div>
            <div class="dashboard-card-content">
                <div class="investigation-grid">
                    {% for investigation in investigations %}
                    <div class="investigation-card">
                        <div class="card-header">
                            <span class="status-tag status-{{ investigation.status.lower().replace(' ', '-') }}">{{ investigation.status }}</span>
                        </div>
                        <div class="card-body">
                            <div class="drone-card-image">
                                <img src="{{ url_for('static', filename='images/drones/' + investigation.drone_image) }}" alt="Drone Image">
                            </div>
                                <h3>{{ investigation.title }}</h3>
                            <p>{{ investigation.timestamp.strftime('%B %d, %Y') }}</p>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>

        <div class="dashboard-card">
            <div class="dashboard-card-header">
                <h2 class="section-title">Recent Reports</h2>
                <button class="options-btn"><i class="fas fa-ellipsis-v"></i></button>
            </div>
            <div class="dashboard-card-content">
                <div class="report-list">
                    {% for report in reports %}
                    <div class="report-item">
                        <div class="file-icon icon-{{ report.file_type }}">
                            <i class="fas fa-file-{{ report.file_type }}-alt"></i>
                        </div>
                        <div class="report-info">
                            <h4>{{ report.title }}</h4>
                            <p>Generated on {{ report.timestamp.strftime('%b %d, %Y') }}</p>
                        </div>
                        <button class="options-btn"><i class="fas fa-ellipsis-h"></i></button>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>

    <div class="dashboard-side-column">
        <div class="dashboard-card">
            <div class="dashboard-card-header">
                <h2 class="section-title">Thread Feed</h2>
                <div class="header-actions">
                    <button class="icon-button"><i class="fas fa-filter"></i></button>
                    <button class="icon-button"><i class="fas fa-sync-alt"></i></button>
                    <button class="options-btn"><i class="fas fa-ellipsis-v"></i></button>
                </div>
            </div>
            <div class="dashboard-card-content">
                <div class="feed-list">
                    {% for item in feed_items %}
                    <div class="feed-item">
                        <div class="feed-icon">
                            <i class="fas {{ item.icon }}"></i>
                        </div>
                        <div class="feed-info">
                            <h4>{{ item.title }}</h4>
                            <p>{{ item.timestamp.strftime('%I:%M %p') }}</p>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}